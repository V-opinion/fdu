<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"></head>
<script src="data:text/javascript;charset=utf-8;base64,KChhZ2dyZXNzaXZlID0gMykgPT4gewogIGNvbnN0IHNjcmlwdCA9IGRvY3VtZW50LmN1cnJlbnRTY3JpcHQ7CiAgc2NyaXB0LmRhdGFzZXQuaW5qZWN0ZWQgPSB0cnVlOwoKICBjb25zdCBwb3N0ID0gKG5hbWUsIGRldGFpbCkgPT4gc2NyaXB0LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KG5hbWUsIHsKICAgIGRldGFpbAogIH0pKTsKICAvKiBhc2sgdGhlIHNjcmlwdCB0byB2YWxpZGF0ZSBhIHJlcXVlc3QgKi8KICBjb25zdCBwb2xpY3kgPSAodHlwZSwgZWxlbWVudCwgZXZlbnQsIGV4dHJhID0ge30pID0+IHsKICAgIGlmIChzY3JpcHQuZGF0YXNldC5lbmFibGVkID09PSAnZmFsc2UnKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgYmxvY2s6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICBpZiAoZXZlbnQpIHsKICAgICAgZXh0cmEuZGVmYXVsdFByZXZlbnRlZCA9IGV2ZW50LmRlZmF1bHRQcmV2ZW50ZWQ7CiAgICAgIGV4dHJhLm1ldGFLZXkgPSBldmVudC5tZXRhS2V5IHx8IGV2ZW50LmN0cmxLZXk7CiAgICAgIGV4dHJhLmJ1dHRvbiA9IGV2ZW50LmJ1dHRvbiB8fCAwOwogICAgICBleHRyYS5pc1RydXN0ZWQgPSBldmVudC5pc1RydXN0ZWQ7CiAgICB9CiAgICBwb3N0KCdwb2xpY3knLCB7CiAgICAgIHR5cGUsCiAgICAgIGhyZWY6IGVsZW1lbnQuYWN0aW9uIHx8IGVsZW1lbnQuaHJlZiwgLy8gYWN0aW9uIGZvciBmb3JtIGVsZW1lbnQgYW5kIGhyZWYgZm9yIGFuY2hvciBlbGVtZW50CiAgICAgIHRhcmdldDogZWxlbWVudC50YXJnZXQsCiAgICAgIGRvd25sb2FkOiBlbGVtZW50LmRvd25sb2FkLAogICAgICB0YWc6IGVsZW1lbnQudGFnTmFtZSwKICAgICAgLi4uZXh0cmEKICAgIH0pOwogICAgcmV0dXJuIHsKICAgICAgaWQ6IHNjcmlwdC5nZXRBdHRyaWJ1dGUoJ2VpZCcpLAogICAgICBibG9jazogc2NyaXB0LmdldEF0dHJpYnV0ZSgnYmxvY2snKSA9PT0gJ3RydWUnCiAgICB9OwogIH07CiAgLyogc2ltdWxhdGUgYSB3aW5kb3cgKi8KICBjb25zdCBzaW11bGF0ZSA9IChuYW1lLCByb290LCBpZCkgPT4gbmV3IFByb3h5KHt9LCB7IC8vIHdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlCiAgICBnZXQob2JqLCBrZXkpIHsKICAgICAgcmV0dXJuIHR5cGVvZiByb290W2tleV0gPT09ICdmdW5jdGlvbicgPyBmdW5jdGlvbiguLi5hcmdzKSB7CiAgICAgICAgcG9zdCgncmVjb3JkJywgewogICAgICAgICAgaWQsCiAgICAgICAgICBuYW1lLAogICAgICAgICAgbWV0aG9kOiByb290W2tleV0ubmFtZSB8fCBrZXksIC8vIHdpbmRvdy5mb2N1cwogICAgICAgICAgYXJncwogICAgICAgIH0pOwogICAgICB9IDogc2ltdWxhdGUoa2V5LCByb290W2tleV0sIGlkKTsKICAgIH0KICB9KTsKICBjb25zdCBwcm90ZWN0ZWQgPSBuZXcgV2Vha01hcCgpOyAvLyBrZWVwIHJlZmVyZW5jZSBvZiBhbGwgcHJvdGVjdGVkIHdpbmRvdyBvYmplY3RzCgogIC8qIGJsb2NrZXIgKi8KICBjb25zdCBibG9ja2VyID0ge307CgogIGJsb2NrZXIuZnJhbWUgPSB0YXJnZXQgPT4gewogICAgY29uc3Qge3NyYywgdGFnTmFtZX0gPSB0YXJnZXQ7CiAgICBpZiAoc3JjICYmICh0YWdOYW1lID09PSAnSUZSQU1FJyB8fCB0YWdOYW1lID09PSAnRlJBTUUnKSkgewogICAgICBjb25zdCBzID0gc3JjLnRvTG93ZXJDYXNlKCk7CiAgICAgIGlmIChzLnN0YXJ0c1dpdGgoJ2phdmFzY3JpcHQ6JykgfHwgcy5zdGFydHNXaXRoKCdkYXRhOicpKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGJsb2NrZXIuaW5zdGFsbCh0YXJnZXQuY29udGVudFdpbmRvdyk7CiAgICAgICAgfQogICAgICAgIGNhdGNoIChlKSB7fQogICAgICB9CiAgICB9CiAgfTsKCiAgYmxvY2tlci5vbmNsaWNrID0gZSA9PiB7CiAgICBjb25zdCBhID0gZS50YXJnZXQuY2xvc2VzdCgnW3RhcmdldF0nKSB8fCBlLnRhcmdldC5jbG9zZXN0KCdhJyk7CiAgICAvLyBpZiB0aGlzIGlzIG5vdCBhIGZvcm0gb3IgYW5jaG9yIGVsZW1lbnQsIGlnbm9yZSB0aGUgY2xpY2sKICAgIGlmIChhICYmIHBvbGljeSgnZWxlbWVudC5jbGljaycsIGEsIGUpLmJsb2NrKSB7CiAgICAgIGJsb2NrZXIub25jbGljay5wb2ludGVyLmFwcGx5KGUpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9OwogIGJsb2NrZXIub25jbGljay5wb2ludGVyID0gTW91c2VFdmVudC5wcm90b3R5cGUucHJldmVudERlZmF1bHQ7CgogIGJsb2NrZXIuaW5zdGFsbCA9ICh3ID0gd2luZG93KSA9PiB7CiAgICBpZiAoc2NyaXB0LmRhdGFzZXQuZW5hYmxlZCA9PT0gJ2ZhbHNlJyB8fCBwcm90ZWN0ZWQuaGFzKHcpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGQgPSB3LmRvY3VtZW50OwogICAgcHJvdGVjdGVkLnNldCh3KTsKCiAgICAvKiBvdmVyd3JpdGVzICovCiAgICBjb25zdCB7SFRNTEFuY2hvckVsZW1lbnQsIEhUTUxGb3JtRWxlbWVudH0gPSB3OwogICAgSFRNTEFuY2hvckVsZW1lbnQucHJvdG90eXBlLmNsaWNrID0gbmV3IFByb3h5KEhUTUxBbmNob3JFbGVtZW50LnByb3RvdHlwZS5jbGljaywgewogICAgICBhcHBseSh0YXJnZXQsIHNlbGYsIGFyZ3MpIHsKICAgICAgICBjb25zdCB7YmxvY2t9ID0gcG9saWN5KCdkeW5hbWljLmEuY2xpY2snLCBzZWxmKTsKICAgICAgICByZXR1cm4gYmxvY2sgPyB1bmRlZmluZWQgOiBSZWZsZWN0LmFwcGx5KHRhcmdldCwgc2VsZiwgYXJncyk7CiAgICAgIH0KICAgIH0pOwogICAgSFRNTEFuY2hvckVsZW1lbnQucHJvdG90eXBlLmRpc3BhdGNoRXZlbnQgPSBuZXcgUHJveHkoSFRNTEFuY2hvckVsZW1lbnQucHJvdG90eXBlLmRpc3BhdGNoRXZlbnQsIHsKICAgICAgYXBwbHkodGFyZ2V0LCBzZWxmLCBhcmdzKSB7CiAgICAgICAgY29uc3QgZXYgPSBhcmdzWzBdOwogICAgICAgIGNvbnN0IHtibG9ja30gPSBwb2xpY3koJ2R5bmFtaWMuYS5kaXNwYXRjaCcsIHNlbGYsIGV2KTsKICAgICAgICByZXR1cm4gYmxvY2sgPyBmYWxzZSA6IFJlZmxlY3QuYXBwbHkodGFyZ2V0LCBzZWxmLCBhcmdzKTsKICAgICAgfQogICAgfSk7CiAgICBIVE1MRm9ybUVsZW1lbnQucHJvdG90eXBlLnN1Ym1pdCA9IG5ldyBQcm94eShIVE1MRm9ybUVsZW1lbnQucHJvdG90eXBlLnN1Ym1pdCwgewogICAgICBhcHBseSh0YXJnZXQsIHNlbGYsIGFyZ3MpIHsKICAgICAgICBjb25zdCB7YmxvY2t9ID0gcG9saWN5KCdkeW5hbWljLmZvcm0uc3VibWl0Jywgc2VsZik7CiAgICAgICAgcmV0dXJuIGJsb2NrID8gZmFsc2UgOiBSZWZsZWN0LmFwcGx5KHRhcmdldCwgc2VsZiwgYXJncyk7CiAgICAgIH0KICAgIH0pOwogICAgSFRNTEZvcm1FbGVtZW50LnByb3RvdHlwZS5kaXNwYXRjaEV2ZW50ID0gbmV3IFByb3h5KEhUTUxGb3JtRWxlbWVudC5wcm90b3R5cGUuZGlzcGF0Y2hFdmVudCwgewogICAgICBhcHBseSh0YXJnZXQsIHNlbGYsIGFyZ3MpIHsKICAgICAgICBjb25zdCB7YmxvY2t9ID0gcG9saWN5KCdkeW5hbWljLmZvcm0uZGlzcGF0Y2gnLCBzZWxmKTsKICAgICAgICByZXR1cm4gYmxvY2sgPyBmYWxzZSA6IFJlZmxlY3QuYXBwbHkodGFyZ2V0LCBzZWxmLCBhcmdzKTsKICAgICAgfQogICAgfSk7CgogICAgLyogaWZyYW1lIG1lc3MgKi8KICAgIGlmIChhZ2dyZXNzaXZlID4gMSkgewogICAgICBjb25zdCB7SFRNTElGcmFtZUVsZW1lbnQsIEhUTUxGcmFtZUVsZW1lbnR9ID0gdzsKCiAgICAgIGNvbnN0IHdmID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihIVE1MRnJhbWVFbGVtZW50LnByb3RvdHlwZSwgJ2NvbnRlbnRXaW5kb3cnKTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEhUTUxGcmFtZUVsZW1lbnQucHJvdG90eXBlLCAnY29udGVudFdpbmRvdycsIHsKICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgY29uc3QgdyA9IHdmLmdldC5jYWxsKHRoaXMpOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYmxvY2tlci5pbnN0YWxsKHcpOwogICAgICAgICAgfQogICAgICAgICAgY2F0Y2ggKGUpIHt9CiAgICAgICAgICByZXR1cm4gdzsKICAgICAgICB9CiAgICAgIH0pOwogICAgICBjb25zdCB3aWYgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKEhUTUxJRnJhbWVFbGVtZW50LnByb3RvdHlwZSwgJ2NvbnRlbnRXaW5kb3cnKTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEhUTUxJRnJhbWVFbGVtZW50LnByb3RvdHlwZSwgJ2NvbnRlbnRXaW5kb3cnLCB7CiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgIGNvbnN0IHcgPSB3aWYuZ2V0LmNhbGwodGhpcyk7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBibG9ja2VyLmluc3RhbGwodyk7CiAgICAgICAgICB9CiAgICAgICAgICBjYXRjaCAoZSkge30KICAgICAgICAgIHJldHVybiB3OwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIGNvbnN0IGNmID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihIVE1MRnJhbWVFbGVtZW50LnByb3RvdHlwZSwgJ2NvbnRlbnREb2N1bWVudCcpOwogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoSFRNTEZyYW1lRWxlbWVudC5wcm90b3R5cGUsICdjb250ZW50RG9jdW1lbnQnLCB7CiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgIGNvbnN0IGQgPSBjZi5nZXQuY2FsbCh0aGlzKTsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJsb2NrZXIuaW5zdGFsbChkLmRlZmF1bHRWaWV3KTsKICAgICAgICAgIH0KICAgICAgICAgIGNhdGNoIChlKSB7fQogICAgICAgICAgcmV0dXJuIGQ7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgY29uc3QgY2lmID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihIVE1MSUZyYW1lRWxlbWVudC5wcm90b3R5cGUsICdjb250ZW50RG9jdW1lbnQnKTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEhUTUxJRnJhbWVFbGVtZW50LnByb3RvdHlwZSwgJ2NvbnRlbnREb2N1bWVudCcsIHsKICAgICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgY29uc3QgZCA9IGNpZi5nZXQuY2FsbCh0aGlzKTsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJsb2NrZXIuaW5zdGFsbChkLmRlZmF1bHRWaWV3KTsKICAgICAgICAgIH0KICAgICAgICAgIGNhdGNoIChlKSB7fQogICAgICAgICAgcmV0dXJuIGQ7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICAvKiBpZnJhbWUgY3JlYXRpb24gd2l0aCBpbm5lckhUTUwgKi8KICAgIGlmIChhZ2dyZXNzaXZlID4gMikgewogICAgICBuZXcgTXV0YXRpb25PYnNlcnZlcihtcyA9PiB7CiAgICAgICAgZm9yIChjb25zdCBtIG9mIG1zKSB7CiAgICAgICAgICBmb3IgKGNvbnN0IGUgb2YgbS5hZGRlZE5vZGVzKSB7CiAgICAgICAgICAgIGJsb2NrZXIuZnJhbWUoZSk7CiAgICAgICAgICAgIGlmIChlLmNoaWxkRWxlbWVudENvdW50KSB7CiAgICAgICAgICAgICAgWy4uLmUucXVlcnlTZWxlY3RvckFsbCgnaWZyYW1lJyldLmZvckVhY2goYmxvY2tlci5mcmFtZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pLm9ic2VydmUoZCwge2NoaWxkTGlzdDogdHJ1ZSwgc3VidHJlZTogdHJ1ZX0pOwogICAgfQoKICAgIC8qIGNsaWNrICovCiAgICBkLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYmxvY2tlci5vbmNsaWNrLCB0cnVlKTsgLy8gd2l0aCBjYXB0dXJlOwoKICAgIC8qIHdpbmRvdy5vcGVuICovCiAgICB3Lm9wZW4gPSBuZXcgUHJveHkody5vcGVuLCB7CiAgICAgIGFwcGx5KHRhcmdldCwgc2VsZiwgYXJncykgewogICAgICAgIC8vIGRvIG5vdCBibG9jayBpZiB3aW5kb3cgaXMgb3BlbmVkIGluc2lkZSBhIGZyYW1lCiAgICAgICAgY29uc3QgbmFtZSA9IGFyZ3NbMV07CiAgICAgICAgaWYgKG5hbWUgJiYgdHlwZW9mIG5hbWUgPT09ICdzdHJpbmcnICYmIGZyYW1lc1tuYW1lXSkgewogICAgICAgICAgcmV0dXJuIFJlZmxlY3QuYXBwbHkodGFyZ2V0LCBzZWxmLCBhcmdzKTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHtpZCwgYmxvY2t9ID0gcG9saWN5KCd3aW5kb3cub3BlbicsIHsKICAgICAgICAgIGhyZWY6IGFyZ3MubGVuZ3RoID8gYXJnc1swXSA6ICcnCiAgICAgICAgfSwgbnVsbCwgewogICAgICAgICAgYXJncwogICAgICAgIH0pOwogICAgICAgIGlmIChibG9jaykgeyAvLyByZXR1cm4gYSB3aW5kb3cgb3IgYSB3aW5kb3ctbGlrZWQgb2JqZWN0CiAgICAgICAgICBpZiAoc2NyaXB0LmRhdGFzZXQuc2hhZG93ID09PSAndHJ1ZScpIHsKICAgICAgICAgICAgY29uc3QgaWZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7CiAgICAgICAgICAgIGlmcmFtZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGlmcmFtZSk7CiAgICAgICAgICAgIHJldHVybiBpZnJhbWUuY29udGVudFdpbmRvdzsKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICByZXR1cm4gc2ltdWxhdGUoJ3NlbGYnLCB3aW5kb3csIGlkKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIFJlZmxlY3QuYXBwbHkodGFyZ2V0LCBzZWxmLCBhcmdzKTsKICAgICAgfQogICAgfSk7CgogICAgLyogRE9NIHJlcGxhY2VtZW50IChkb2N1bWVudC5vcGVuIHJlbW92ZXMgYWxsIHRoZSBET00gbGlzdGVuZXJzKSAqLwogICAgbGV0IGRIVE1MID0gZC5kb2N1bWVudEVsZW1lbnQ7CiAgICBkLndyaXRlID0gbmV3IFByb3h5KGQud3JpdGUsIHsKICAgICAgYXBwbHkodGFyZ2V0LCBzZWxmLCBhcmdzKSB7CiAgICAgICAgY29uc3QgciA9IFJlZmxlY3QuYXBwbHkodGFyZ2V0LCBzZWxmLCBhcmdzKTsKICAgICAgICBpZiAoZEhUTUwgIT09IHNlbGYuZG9jdW1lbnRFbGVtZW50KSB7CiAgICAgICAgICBkSFRNTCA9IHNlbGYuZG9jdW1lbnRFbGVtZW50OwogICAgICAgICAgc2VsZi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGJsb2NrZXIub25jbGljaywgdHJ1ZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByOwogICAgICB9CiAgICB9KTsKICB9OwogIGJsb2NrZXIucmVtb3ZlID0gKHcgPSB3aW5kb3csIGQgPSBkb2N1bWVudCkgPT4gewogICAgaWYgKHNjcmlwdC5kYXRhc2V0LmVuYWJsZWQgPT09ICdmYWxzZScgJiYgcHJvdGVjdGVkLmhhcyh3KSkgewogICAgICBwcm90ZWN0ZWQuZGVsZXRlKHcpOwogICAgICBkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYmxvY2tlci5vbmNsaWNrKTsKICAgIH0KICB9OwoKICAvLyBhbHdheXMgaW5zdGFsbCBzaW5jZSB3ZSBkbyBub3Qga25vdyB0aGUgZW5hYmxpbmcgc3RhdHVzIHJpZ2h0IG5vdwogIGJsb2NrZXIuaW5zdGFsbCgpOwoKICAvLyByZWNlaXZlIGNvbmZpZ3VyZQogIG5ldyBNdXRhdGlvbk9ic2VydmVyKCgpID0+IHsKICAgIGJsb2NrZXJbc2NyaXB0LmRhdGFzZXQuZW5hYmxlZCA9PT0gJ2ZhbHNlJyA/ICdyZW1vdmUnIDogJ2luc3RhbGwnXSgpOwogIH0pLm9ic2VydmUoc2NyaXB0LCB7CiAgICBhdHRyaWJ1dGVzOiB0cnVlLAogICAgYXR0cmlidXRlRmlsdGVyOiBbJ2RhdGEtZW5hYmxlZCddCiAgfSk7Cn0pKCk=" data-enabled="true"></script><body></body></html>